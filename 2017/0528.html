<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实现 electron-tunnel | Saul Shen&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Keep simple, keep happy">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.4fe4e32b.js" as="script"><link rel="preload" href="/blog/assets/js/2.6fe09025.js" as="script"><link rel="preload" href="/blog/assets/js/11.4d53f011.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.530dcc5b.js"><link rel="prefetch" href="/blog/assets/js/12.045882ce.js"><link rel="prefetch" href="/blog/assets/js/13.6645e80b.js"><link rel="prefetch" href="/blog/assets/js/14.d555f6c2.js"><link rel="prefetch" href="/blog/assets/js/15.4161ee70.js"><link rel="prefetch" href="/blog/assets/js/16.3672a1d7.js"><link rel="prefetch" href="/blog/assets/js/17.0127db4b.js"><link rel="prefetch" href="/blog/assets/js/18.291a8fd7.js"><link rel="prefetch" href="/blog/assets/js/19.57cab65a.js"><link rel="prefetch" href="/blog/assets/js/20.5789a416.js"><link rel="prefetch" href="/blog/assets/js/21.9266840a.js"><link rel="prefetch" href="/blog/assets/js/22.b62e8f4a.js"><link rel="prefetch" href="/blog/assets/js/23.4a3ae109.js"><link rel="prefetch" href="/blog/assets/js/24.cea5c6c5.js"><link rel="prefetch" href="/blog/assets/js/25.1fca3e8c.js"><link rel="prefetch" href="/blog/assets/js/26.20a38b6d.js"><link rel="prefetch" href="/blog/assets/js/27.1b8292e7.js"><link rel="prefetch" href="/blog/assets/js/28.1d5e2edf.js"><link rel="prefetch" href="/blog/assets/js/29.e8700342.js"><link rel="prefetch" href="/blog/assets/js/3.3692318b.js"><link rel="prefetch" href="/blog/assets/js/30.9eca39c6.js"><link rel="prefetch" href="/blog/assets/js/4.82a020f0.js"><link rel="prefetch" href="/blog/assets/js/5.41beb069.js"><link rel="prefetch" href="/blog/assets/js/6.e8cd7694.js"><link rel="prefetch" href="/blog/assets/js/7.6b1babaf.js"><link rel="prefetch" href="/blog/assets/js/8.9eb0f85d.js"><link rel="prefetch" href="/blog/assets/js/9.d9d6b09e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Saul Shen's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实现-electron-tunnel"><a href="#实现-electron-tunnel" class="header-anchor">#</a> 实现 electron-tunnel</h1> <blockquote><p><code>2017-05-28</code> by <code>Saul Shen</code></p></blockquote> <p>##项目连接
<a href="https://github.com/Hokkaidosunny/electron-tunnel" target="_blank" rel="noopener noreferrer">github 链接(electron-tunnel)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="motivition"><a href="#motivition" class="header-anchor">#</a> Motivition</h1> <ul><li>无需区分进程。如果想一套代码同时能跑在 web 环境和 electron 环境中，就需要在代码中先判断环境，再分别写对应的逻辑。每次写到 electron 环境下的逻辑，又要区分渲染进程和主进程，因为有些事只能渲染进程做，有些事只能主进程做。所以，我希望能将这些抽象出来，某个方法，只能在 electron 环境下被调用，并且不需要关心在什么进程下，web 只要判断环境，调不同的方法就行，不需要关心和 electron 的交互。</li> <li>快速迭代。如果需要快速的开启另一个 electron 的项目，我希望我 web 里的代码能轻易的获取到 electron 的能力，而不是重新开始编写，这个时候，我希望有一层对 electron 能力的封装。</li> <li>团队合作。团队内有些成员对 web 很熟悉，但是对 electron 不是很了解，如果能有一个库列出了所有 electron 能做的事，你只需要调用，无需关心它是怎么实现的，能很大程度提高开发效率。</li></ul> <h1 id="goals"><a href="#goals" class="header-anchor">#</a> Goals</h1> <ol><li>给 web 注入适当的环境变量，让 web 知道自己的环境</li> <li>给 web 注入一个对象，包含所有 electron 能做的事（包括主进程、渲染进程）</li></ol> <h1 id="how-to-do"><a href="#how-to-do" class="header-anchor">#</a> How to do</h1> <p>在 load web 页面的时候，有个 webPreferences 配置，我们在这里预加载一个 js 文件，就是 electron-bridge.js</p> <p>这个文件拥有 node 的能力，并且它是属于渲染进程的，所以它能做渲染进程里的事, 也能跟主进程通讯。</p> <h1 id="let-s-do-it"><a href="#let-s-do-it" class="header-anchor">#</a> Let's do it</h1> <h3 id="给-web-注入适当的环境变量"><a href="#给-web-注入适当的环境变量" class="header-anchor">#</a> 给 web 注入适当的环境变量</h3> <ol><li>加载 bridge.js</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  width<span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
  show<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  webPreferences<span class="token operator">:</span> <span class="token punctuation">{</span>
    preload<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../bridge/bridge.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>当我们启动 electron 的时候，主进程开始通知这个渲染进程，给渲染进程注入主进程的环境变量，再有渲染进程挂载到 window 对象上，这样 web 就能获取自己的环境信息</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//bridge.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token comment">//监听主进程，设置环境变量</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'set-env'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> msg<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//main.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>BrowserWindow<span class="token punctuation">,</span> ipcMain<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取创建好的window对象发送消息</span>
win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'set-env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">//设置web环境变量</span>
    __ELECTRON__<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    __DEV__<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    __PRO__<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    __SERVER__<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    windowLoaded<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="通过-bridge-js-来调用主进程的方法"><a href="#通过-bridge-js-来调用主进程的方法" class="header-anchor">#</a> 通过 bridge.js 来调用主进程的方法</h2> <ol start="3"><li>我们通过 ipcRender 给主进程发送一系列消息，包括做什么事情(eventName), 根据哪些参数（params），对外根据不同的事件暴露不同的方法，接受参数，和回调函数。</li></ol> <ul><li>先将回调函数放在 eventsMap 上暂存起来，因为 ipcRender 不能发送函数，所有的信息会被序列化后再发送给主进程，所以，我们先生成一个时间戳，让 eventsMap[时间戳] = cb 并把时间戳一同发送过去，等一会儿，主进程通知渲染进程调用哪个时间戳函数</li> <li>通过'resist-event'频道, 发送参数，包括 eventName、params、timeStamp</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//bridge.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> eventsMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//调用原生事件</span>
<span class="token keyword">function</span> <span class="token function">registEvent</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> params<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//允许只传两个数据</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cb <span class="token operator">=</span> params
    params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//如果win还未ready</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>windowLoaded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'window not ready'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> stamp <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> eventName <span class="token punctuation">}</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span> stamp <span class="token punctuation">}</span><span class="token punctuation">)</span>
  eventsMap<span class="token punctuation">[</span>stamp<span class="token punctuation">]</span> <span class="token operator">=</span> cb <span class="token comment">//注册唯一函数</span>
  ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'regist-event'</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span> <span class="token comment">//发送事件</span>
<span class="token punctuation">}</span>

<span class="token comment">//进入全屏</span>
<span class="token keyword">function</span> <span class="token function">setFullScreen</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">registEvent</span><span class="token punctuation">(</span><span class="token constant">SET_FULL_SCREEN</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span>ElectronBridge <span class="token operator">=</span> <span class="token punctuation">{</span>
  setFullScreen
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>主进程监听‘resist-event’频道，做对应的事。我们会将所有主进程能做的事，放在 eventsList 对象下，当接受到渲染进程的通知，去 eventsList 找有没有对应的事能做，有，做完通过 promise，或者通过回调函数，去在‘fire-event’频道通知，渲染进程，事情已经做完，并把数据传回去，包括 stamp(之前渲染进程传过来的，现在传回去，告诉渲染进程执行哪个回调函数) 、 payload(返回数据) 、err (错误信息)</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//main.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcMain <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token comment">//监听对原生的调用</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'regist-event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nativeEvent <span class="token operator">=</span> eventsList<span class="token punctuation">[</span>arg<span class="token punctuation">.</span>eventName<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nativeEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">nativeEvent</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> win<span class="token punctuation">,</span> arg<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'fire-event'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            stamp<span class="token operator">:</span> arg<span class="token punctuation">.</span>stamp<span class="token punctuation">,</span>
            payload<span class="token operator">:</span> res
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'fire-event'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            stamp<span class="token operator">:</span> arg<span class="token punctuation">.</span>stamp<span class="token punctuation">,</span>
            err
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'fire-event'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        stamp<span class="token operator">:</span> arg<span class="token punctuation">.</span>stamp<span class="token punctuation">,</span>
        payload<span class="token operator">:</span> result
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'fire-event'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      stamp<span class="token operator">:</span> arg<span class="token punctuation">.</span>stamp<span class="token punctuation">,</span>
      err<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'event not support'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>渲染进程监听‘fire-event’执行对应时间戳回调函数，并把主进程传过来的数据传给回调函数。触发完成后，删掉该回调函数。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//bridge.js</span>

<span class="token comment">//触发事件回调</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'fire-event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cb <span class="token operator">=</span> eventsMap<span class="token punctuation">[</span>arg<span class="token punctuation">.</span>stamp<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>err<span class="token punctuation">,</span> arg<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> arg<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> eventsMap<span class="token punctuation">[</span>arg<span class="token punctuation">.</span>stamp<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="6"><li>如果是渲染进程能做的事，就不需要再和主进程通讯，可以直接完成触发回调</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//bridge.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> webFrame <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token comment">//设置缩放比，只能在渲染进程中实现</span>
<span class="token keyword">function</span> <span class="token function">setZoomFactor</span><span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  webFrame<span class="token punctuation">.</span><span class="token function">setZoomFactor</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
  cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span>ElectronBridge <span class="token operator">=</span> <span class="token punctuation">{</span>
  setZoomFactor
<span class="token punctuation">}</span>
</code></pre></div><ol start="7"><li>最终 web 中的 js 代码去调用 bridge.js 暴露出来的方法</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ../web/index.js</span>

$btn1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__ELECTRON__ <span class="token operator">&amp;&amp;</span> ElectronBridge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//electron 环境</span>
    ElectronBridge<span class="token punctuation">.</span><span class="token function">setFullScreen</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//web 环境</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'不能设置全屏'</span><span class="token punctuation">)</span>
    <span class="token comment">//do something else</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.4fe4e32b.js" defer></script><script src="/blog/assets/js/2.6fe09025.js" defer></script><script src="/blog/assets/js/11.4d53f011.js" defer></script>
  </body>
</html>
